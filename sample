pipeline {
    environment {
        registry = "noel135/img-repo"
        registryCredential = 'docker-credential'
        dockerImage = ''
        docker_version = "${BUILD_NUMBER}"
        deployment_file = "${WORKSPACE}/deployment.yaml"
        KUBECONFIG_CREDENTIAL_ID = 'kubeconfig' // Define this
    }
    agent any
    stages {
        stage('Apply Kubernetes YAML') {
            steps {
                withCredentials([file(credentialsId: 'kubeconfig', variable: 'KUBECONFIG')]) {
                    sh "kubectl apply -f ${deployment_file} -n noelapp"
                }
            }
        }
     }
}
